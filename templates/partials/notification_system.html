<!-- Pro Max Notification System (Alpine.js + Tailwind) -->
<style>
    [x-cloak] { display: none !important; }
    
    .glass {
        background: rgba(255, 255, 255, 0.75);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .glass-dark {
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    @keyframes toast-in {
        from { transform: translateX(100%) scale(0.9); opacity: 0; }
        to { transform: translateX(0) scale(1); opacity: 1; }
    }

    @keyframes toast-out {
        from { transform: translateX(0) scale(1); opacity: 1; }
        to { transform: translateX(100%) scale(0.9); opacity: 0; }
    }

    .animate-toast-in { animation: toast-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    .animate-toast-out { animation: toast-out 0.3s ease-in forwards; }

    @keyframes modal-in {
        from { transform: scale(0.95) translateY(10px); opacity: 0; }
        to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .animate-modal-in { animation: modal-in 0.3s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }

    .progress-bar {
        height: 3px;
        background: rgba(0, 0, 0, 0.05);
        width: 100%;
        position: absolute;
        bottom: 0;
        left: 0;
    }

    .progress-fill {
        height: 100%;
        background: currentColor;
        width: 0%;
        transition: width linear;
    }
</style>

<script>
    document.addEventListener('alpine:init', () => {
        if (Alpine.store('notif')) return; // Avoid double init
        
        Alpine.store('notif', {
            toasts: [],
            modal: { show: false, title: '', message: '', type: 'info', confirmText: 'OK', cancelText: 'Cancel', isConfirm: false, resolve: null },

            add(message, type = 'info', duration = 5000) {
                const id = Date.now();
                this.toasts.push({ id, message, type: type || 'info', duration, removing: false });
                setTimeout(() => this.remove(id), duration);
            },

            remove(id) {
                const toast = this.toasts.find(t => t.id === id);
                if (toast) {
                    toast.removing = true;
                    setTimeout(() => {
                        this.toasts = this.toasts.filter(t => t.id !== id);
                    }, 400);
                }
            },

            alert(message, title = 'Notification') {
                return new Promise(resolve => {
                    this.modal = { show: true, title, message, type: 'info', confirmText: 'OK', isConfirm: false, resolve };
                });
            },

            confirm(message, title = 'Are you sure?') {
                return new Promise(resolve => {
                    this.modal = { show: true, title, message, type: 'warning', confirmText: 'Yes, Proceed', cancelText: 'Cancel', isConfirm: true, resolve };
                });
            },

            closeModal(result) {
                const resolve = this.modal.resolve;
                this.modal.show = false;
                if (resolve) resolve(result);
            }
        });

        window.toast = {
            success: (m, d) => Alpine.store('notif').add(m, 'success', d),
            error: (m, d) => Alpine.store('notif').add(m, 'error', d),
            info: (m, d) => Alpine.store('notif').add(m, 'info', d),
            warning: (m, d) => Alpine.store('notif').add(m, 'warning', d),
        };

        window.alert = (message) => Alpine.store('notif').alert(message);
        window.confirm = (message) => Alpine.store('notif').confirm(message);
    });
</script>

<div x-data x-cloak>
    <!-- Toasts -->
    <div class="fixed bottom-6 right-6 z-[9999] flex flex-col space-y-4 max-w-md w-full pointer-events-none">
        <template x-for="toast in $store.notif.toasts" :key="toast.id">
            <div 
                class="glass pointer-events-auto overflow-hidden rounded-2xl shadow-2xl flex items-center p-4 border-l-4"
                :class="{
                    'animate-toast-in': !toast.removing,
                    'animate-toast-out': toast.removing,
                    'border-green-500 bg-green-50/90': toast.type.includes('success'),
                    'border-red-500 bg-red-50/90': toast.type.includes('error') || toast.type.includes('danger'),
                    'border-blue-500 bg-blue-50/90': toast.type.includes('info'),
                    'border-yellow-500 bg-yellow-50/90': toast.type.includes('warning')
                }"
            >
                <div class="flex-shrink-0 mr-3">
                    <template x-if="toast.type.includes('success')"><i class="fas fa-check-circle text-green-500 text-xl"></i></template>
                    <template x-if="toast.type.includes('error') || toast.type.includes('danger')"><i class="fas fa-exclamation-circle text-red-500 text-xl"></i></template>
                    <template x-if="toast.type.includes('info')"><i class="fas fa-info-circle text-blue-500 text-xl"></i></template>
                    <template x-if="toast.type.includes('warning')"><i class="fas fa-exclamation-triangle text-yellow-500 text-xl"></i></template>
                </div>
                <div class="flex-1 text-sm font-semibold text-gray-800" x-text="toast.message"></div>
                <button @click="$store.notif.remove(toast.id)" class="ml-4 text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
                <div class="progress-bar">
                    <div class="progress-fill" 
                         :class="{
                            'text-green-500': toast.type.includes('success'),
                            'text-red-500': toast.type.includes('error') || toast.type.includes('danger'),
                            'text-blue-500': toast.type.includes('info'),
                            'text-yellow-500': toast.type.includes('warning')
                         }"
                         :style="`transition-duration: ${toast.duration}ms; width: 0%`"
                         x-init="setTimeout(() => $el.style.width = '100%', 50)"></div>
                </div>
            </div>
        </template>
    </div>

    <!-- Modal -->
    <div 
        x-show="$store.notif.modal.show" 
        class="fixed inset-0 z-[10000] overflow-y-auto" 
        style="display: none;"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity bg-slate-900/60 backdrop-blur-md" @click="$store.notif.closeModal(false)"></div>

            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <div 
                class="inline-block glass-dark align-bottom rounded-[2rem] text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full animate-modal-in"
                @click.stop
            >
                <div class="px-6 pt-6 pb-4 sm:p-10 sm:pb-6">
                    <div class="sm:flex sm:items-start">
                        <div 
                            class="mx-auto flex-shrink-0 flex items-center justify-center h-16 w-16 rounded-2xl sm:mx-0 sm:h-14 sm:w-14"
                            :class="{
                                'bg-blue-500/20 text-blue-400': $store.notif.modal.type === 'info',
                                'bg-yellow-500/20 text-yellow-400': $store.notif.modal.type === 'warning',
                                'bg-green-500/20 text-green-400': $store.notif.modal.type === 'success',
                                'bg-red-500/20 text-red-400': $store.notif.modal.type === 'error'
                            }"
                        >
                            <template x-if="$store.notif.modal.type === 'info'"><i class="fas fa-info-circle text-2xl"></i></template>
                            <template x-if="$store.notif.modal.type === 'warning'"><i class="fas fa-exclamation-triangle text-2xl"></i></template>
                            <template x-if="$store.notif.modal.type === 'success'"><i class="fas fa-check-circle text-2xl"></i></template>
                            <template x-if="$store.notif.modal.type === 'error'"><i class="fas fa-exclamation-circle text-2xl"></i></template>
                        </div>
                        <div class="mt-4 text-center sm:mt-0 sm:ml-6 sm:text-left">
                            <h3 class="text-2xl leading-6 font-bold text-white tracking-tight" x-text="$store.notif.modal.title"></h3>
                            <div class="mt-4">
                                <p class="text-gray-300 leading-relaxed text-lg" x-text="$store.notif.modal.message"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-6 sm:px-10 sm:py-8 flex flex-row-reverse space-x-reverse space-x-4">
                    <button 
                        @click="$store.notif.closeModal(true)"
                        type="button" 
                        class="w-full inline-flex justify-center rounded-2xl border border-transparent shadow-lg px-8 py-4 text-base font-bold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto transition-all hover:scale-105 active:scale-95 shadow-xl"
                        :class="{
                            'bg-blue-600 hover:bg-blue-500 focus:ring-blue-500': $store.notif.modal.type === 'info',
                            'bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500': $store.notif.modal.type === 'warning',
                            'bg-green-600 hover:bg-green-500 focus:ring-green-500': $store.notif.modal.type === 'success',
                            'bg-red-600 hover:bg-red-500 focus:ring-red-500': $store.notif.modal.type === 'error'
                        }"
                        x-text="$store.notif.modal.confirmText"
                    ></button>
                    <button 
                        x-show="$store.notif.modal.isConfirm"
                        @click="$store.notif.closeModal(false)"
                        type="button" 
                        class="mt-3 w-full inline-flex justify-center rounded-2xl border border-gray-600 shadow-sm px-8 py-4 bg-transparent text-base font-medium text-gray-300 hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:w-auto transition-all"
                        x-text="$store.notif.modal.cancelText"
                    ></button>
                </div>
            </div>
        </div>
    </div>
</div>

<div x-data x-init="
    {% if messages %}
        {% for message in messages %}
            $store.notif.add('{{ message|escapejs }}', '{{ message.tags }}');
        {% endfor %}
    {% endif %}
"></div>
